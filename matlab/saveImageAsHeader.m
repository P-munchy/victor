
% function saveImageAsHeader(image, filename, imageName)

function saveImageAsHeader(image, filename, imageName)

image = im2uint8(image)';

fileId = fopen(filename, 'w');

curDate = date();

maxSlash = max([strfind(filename, '\'), strfind(filename, '/')]);
maxDot = max(strfind(filename, '.'));
defineFilename = filename((maxSlash+1):(maxDot-1));


if ~exist('imageName', 'var')
    imageName = defineFilename;
end

fprintf(fileId,...
    ['// Autogenerated by saveImageAsHeader.m on ', curDate([8:end,3,4:6,3,1:2]), '\n',...
    '\n',...
    '#ifndef _SAVEIMAGEASHEADER_', defineFilename, '_H_\n',...
    '#define _SAVEIMAGEASHEADER_', defineFilename, '_H_\n',...
    '\n',...
    '#define ', imageName, sprintf('_WIDTH %d\n',size(image,2)),...
    '#define ', imageName, sprintf('_HEIGHT %d\n',size(image,1)),...
    '#define ', imageName, '_NAME "', imageName, '"\n',...
    '\n',...
    '#if defined(USING_MOVIDIUS_COMPILER)\n',...
    '__attribute__((section(".ddr_direct.text")))\n',...
    '#endif\n',...
    'const unsigned char ', imageName, '[', imageName, '_WIDTH*', imageName, '_HEIGHT] = {\n']);

for y = 1:size(image,2)
    fprintf(fileId, '%d, ', image(:,y));
    fprintf(fileId, '\n');
end

fprintf(fileId,...
    ['};\n\n',...
     '#endif // _SAVEIMAGEASHEADER_', defineFilename, '_H_']);

fclose(fileId);