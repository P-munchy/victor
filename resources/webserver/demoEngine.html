<!doctype html>
<html lang="en">

<!-- page preamble -->

<!-- Elemental --> 

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Elemental demo Engine iFrame</title>
  <link rel="stylesheet" href="jquery-ui-1.12.1.custom/jquery-ui.css">
  <link rel="stylesheet" href="style.css">
  <script src="jquery-1.12.4.js"></script>
  <script src="jquery-ui.js"></script>

  <script>
    var hostname = "";  // (Effectively, the device IP)
    var host = "";      // hostname and port (e.g. "192.168.42.82:8888"

    $(document).ready(function() {
        $('#btn_show_photos').click(ButtonHandler_ShowPhotos);
        $('#btn_erase_all_photos').click(ButtonHandler_EraseAllPhotos);
        InitConfirmDialog();

        // Pull out hostname (device IP) so we can use it in here to call into ANY of the webservers
        var urlObject = new URL(document.URL);
        host = urlObject.host;
        hostname = urlObject.hostname;
        console.log('host is: ' + host);
        console.log('hostname is: ' + hostname);

        // get the state names from the console function
        $.get("consolefunccall?func=TheBoxMoveToState&args=list").success(function(data){
          data.trim().split(" ").forEach(function(state) {
            $('#DemoState')
              .append($("<option></option>")
                      .attr("value",state)
                      .text(state));
            console.log("adding demo state: " + state);
          });
        });

    });
    $(function() {
        $("button").click(function(event) {
            event.preventDefault();
        });
        $("input[type='submit']").click(function(event) {
          $.post("/"+event.target.value, function(data) {
            $("#content").html(data);
            $("#content").show();
            InitConfirmDialog();
          });
          event.preventDefault();
        });
        $('#MasterVolumeLevel').selectmenu({
          create: function(event, ui) {
            $.post('consolevarget?key=MasterVolumeLevel', function(result) {
              var value = parseInt(result);
              $('#MasterVolumeLevel').prop("selectedIndex", value).selectmenu('refresh');
            });
          },
          change: function(event, data) {
            $.post("consolevarset", {key: "MasterVolumeLevel", value: data.item.index}, function(result) {
              $.post("consolefunccall", {func: "DebugSetMasterVolume", args: ""}, function(result) {});
            });
          }
        });
        $('#DemoState').selectmenu({
          change: function(event, data) {
            if(data.item.value) {
              $.post("consolefunccall", {func: "TheBoxMoveToState", args: data.item.value}, function(result){
              });
            }
          }
        });

    });

    function InitConfirmDialog() {
      $("#confirm_dialog").dialog({ autoOpen: false, modal: true, resizable: false,
        draggable: true,
        width: 'auto',
        buttons: {
          "OK": function() {
            $("#confirm_dialog").dialog("close");
            if (dialogOKFunction !== undefined) {
              dialogOKFunction();
              dialogOKFunction = undefined;
            }
          },
          "Cancel": function () {
            $("#confirm_dialog").dialog("close");
            dialogOKFunction = undefined;
          }
        } });
    }

    function StartConfirmDialog(title, body, okfunction) {
      dialogOKFunction = okfunction;
      $("#confirm_dialog_body").html(body);
      var d = $("#confirm_dialog");
      d.dialog("option", "title", title);
      d.dialog("open");
    }

    function ButtonHandler_ShowPhotos() {
      var url = 'http://' + host + '/photos.html';
      var win = window.open(url, '_blank');
      if (win) {
        win.focus();
      } else {
        alert('Please allow popups for this website');
      }
    }

    function ButtonHandler_EraseAllPhotos() {
      StartConfirmDialog("", "Erase all photos:", function() {
        $.post('/deleteallphotos', function(data) {});
      });
    }

  </script>
</head>

<!-- page content -->

<body class="ui-widget-content" style="border:0;background:#000000">
  <div>
    <div>
      <select name="DemoState" id='DemoState' class='listbox'>
      <option value="">------</option>
      </select>
      <label for="DemoState-button">Switch to State</label>
    </div>
    <br>
    <div>
      <select name="MasterVolumeLevel" id='MasterVolumeLevel' class='listbox'>
        <option>Mute</option>
        <option>Low</option>
        <option>Medium Low</option>
        <option>Medium</option>
        <option>Medium High</option>
        <option>High</option>
      </select>
      <label for="MasterVolumeLevel-button">Master Volume</label>
    </div>
    <br>
    <button id='btn_show_photos' class='ui-button ui-corner-all ui-widget'>Show photos</button>
    <button id='btn_erase_all_photos' style='color:darksalmon;' class='ui-button ui-corner-all ui-widget'>Erase all photos</button>
    <br>
  </div>
  <div id="confirm_dialog" title="">
    <p id='confirm_dialog_body'></p>
    <p>Are you sure?</p>
  </div>
</body>

</html>
