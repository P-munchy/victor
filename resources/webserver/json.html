<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">

  <title>Modify OverDrive JSON</title>

  <!-- jQuery 3.2.1, MIT license: https://jquery.org/license/ -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script> 
  
  <style type="text/css">
    html, body {
      top: 0;
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
      overflow: hidden;
      font-family: Arial;
    }

    .formItem {
      padding-top:20px;
    }
  </style>
</head>

<body>


<h3>Modify OverDrive Json</h3>

  <form id="data" action="">
    <div class="formItem">
      <select id="jsonList" name="jsonList">
        <option value="NOTAJSONFILE">Choose a config file...</option>
        <!-- generated code below: -->
        <!-- json list -->
      </select>
    </div>

    <div class="formItem" style="display:none;">
      Upload a replacement: <input type="file" name="filein" id="fileSelector" accept=".json">
    </div>
    
    <div class="formItem" style="display:none;">
      <input type="submit" value="Submit"  formmethod="POST"  formenctype="multipart/form-data">
      <br/>
      (Uploaded json will only persist as long as the app is running)
    </div>
    
  </form>

  <script>

    var initialDropdownValue = 'NOTAJSONFILE';
    $('#jsonList').change( function() {
      
      var defaultOption = $('#jsonList option[value="' + initialDropdownValue + '"]');
      if( typeof defaultOption !== 'undefined' ) {
        defaultOption.remove();
      }

      $('#fileSelector').parent().show();

    });

    $("input[type=file]").change(function(){
        var filename = $(this).val().replace(/^.*\\/, "");

        $("input[type=submit]").parent().show();
    });

    $("form#data").submit(function(){

      var formData = new FormData(this);

      $.ajax({
        url: '/jsonUpload',
        type: 'POST',
        data: formData,
        success: function (data) {
          alert('Success! ' + data)
        },
        cache: false,
        contentType: false,
        processData: false
      });

      $("input[type=submit]").parent().hide();
      $("input[type=file]").val('');

      return false;
    });
  </script>
</body>

</html>