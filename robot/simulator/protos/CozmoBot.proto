PROTO CozmoBot [
  field SFVec3f translation 0 0.02 0
  field SFRotation rotation 0 1 0 0
  field SFString name "Cozmo"
  field SFFloat fieldOfViewDown 1.57
  field SFFloat fieldOfViewHead 1.57
  field SFBool useSphericalHeadCamera FALSE
  field SFFloat headAngle 0 
  field SFFloat liftAngle 0
  field SFInt32 commsChannel 1
  field SFInt32 usbChannel 88
  field SFString controller "cozmo_c_controller"
  
  #field SFVec3f spotLightTranslation 0 .03 -.03
  #field SFRotation spotLightRotation 1 0 0 0
  #field SFFloat spotLightBeamWidth 0.5
  #field SFFloat spotLightCutOffAngle 0.8
  #field SFVec3f spotLightDirection 0 0 -1
]
{
Supervisor {
  translation IS translation
  rotation IS rotation
  
  children [
    
    # Comms for sending paths for drawing to the physics plugin
    Emitter { 
      name "cozmo_physics_comms"
    }

    # For simulated radio communications with basestation
    # World must be running the CozmoSimWorldComms controller.
    Emitter {
      name "radio_tx"
      type "radio"
      channel IS commsChannel
    }
    Receiver {
      name "radio_rx"
      type "radio"
      channel IS commsChannel
    }
    
    # For simulated USB connection to do "offboard" vision
    # processing
    Emitter {
       name "usb_tx"
       type "radio"
       bufferSize 500000
       channel IS usbChannel
    }
    Receiver {
       name "usb_rx"
       type "radio"
       channel IS usbChannel
    }
    
    
    Solid {
      translation -0.06 0.027 0
      children [
        DEF LBase Shape {
          geometry Box {
            size 0.01 0.02 0.01
          }
        }
        Transform {
          children [
            HingeJoint {
              jointParameters HingeJointParameters {
                position IS liftAngle
                axis 0 0 1
              }
              device RotationalMotor {
                name "lift_motor"
              }
              endPoint Solid {
                translation 0.045 0 0
                children [
                  HingeJoint {
                    jointParameters HingeJointParameters {
                      anchor 0.045 0 0
                      axis   0 0 1
                    }
                    device RotationalMotor {
                      name "lift_motor2"
                    }
                    endPoint Solid {
                      translation 0.05 0 0
                      children [
                      
                        #DEF CAM_LIFT Camera {
                        #  translation 0 0 -0.001
                        #  name "cam_lift"
                        #  width 320
                        #  height 240
                        #  near 0.001
                        #  windowPosition 0.45339 0.0923077
                        #  pixelSize 0.5
                        #}
                        Connector {
                          translation 0.0025 0 0
                          rotation 0 1 0 3.14159
                          model "magnetic"
                          type "active"
                          distanceTolerance 0.003
                          snap TRUE
                        }
                        DEF LIFTFRONT Shape {
                          geometry Box {
                            size 0.005 0.01 0.03
                          }
                        }
                      ]
                      boundingObject USE LIFTFRONT
                      physics Physics {
                        density 1
                      }
                    }
                  }
                  DEF LBottom Shape {
                    geometry Box {
                      size 0.095 0.005 0.001
                    }
                  }
                  #Solid {
                    #translation -0.036 0 0
                    #children [
                      #DEF LIFTBAR Shape {
                        #geometry Box {
                          #size 0.001 0.005 0.09
                        #}
                      #}
                    #]
                    #boundingObject USE LIFTBAR
                  #}
                  #Solid {
                    #translation 0.036 0 0
                    #children [
                      #USE LIFTBAR
                    #]
                    #boundingObject USE LIFTBAR
                  #}
                ]
                boundingObject USE LBottom
                physics Physics {
                  density 1
                  centerOfMass [
                    0 0 0
                  ]
                }
              }
            }
          ]
        }
      ]
      boundingObject USE LBase
      physics Physics {
        density 50000
      }
    }
    Solid {
      translation -0.025 .002 0
      children [
        DEF BODY Shape {
          appearance Appearance {
            material DEF MAT_WHITE Material {
              diffuseColor 1 1 1
            }
          }
          geometry Box {
            size 0.08 0.030 0.04
          }
        }
      ]
    }
    Solid {
      translation -0.025 0.002 0
      children [
        #DEF BODYA Shape {
          #appearance Appearance {
            #material DEF MAT_WHITE Material {
              #diffuseColor 1 1 1
            #}
          #}
          #geometry Box {
            #size 0.04 0.035 0.02
          #}
        #}
        DEF CAM_DOWN Camera {
          translation 0 -0.005 0
          #rotation 1 0 0 -1.5708
          rotation -0.5774 -0.5774 -0.5774 2.0944
          name "cam_down"
          fieldOfView IS fieldOfViewDown
          width 640
          height 480
          near 0.001
          pixelSize 0.3
          colorNoise 0.01
        }
      ]
      boundingObject USE BODY
      physics Physics {
        density 5000
      }
    }
    DEF WHEEL_REAR_LEFT HingeJoint {
      jointParameters HingeJointParameters {
        anchor -0.05 0 0.03
        axis 0 0 1
      }
      endPoint Solid {
        translation -0.05 0 0.03
        rotation 1 0 0 1.5708
        children [
          DEF WHEEL_BOX Shape {
            appearance Appearance {
              material Material {
                diffuseColor 0.505501 0.505501 0.505501
              }
            }
            geometry Box {
              size 0.01 0.002 0.02
            }
          }
          DEF WHEEL Transform {
            rotation 1 0 0 0
            children [
              Shape {
                appearance Appearance {
                  material Material {
                    diffuseColor 0.254032 0.254032 0.254032
                  }
                }
                geometry Cylinder {
                  height 0.02
                  radius 0.02
                  subdivision 36
                }
              }
            ]
          }
        ]
        contactMaterial "nofriction"
        boundingObject USE WHEEL
        physics Physics {
        }
      }
    }
    DEF WHEEL_REAR_RIGHT HingeJoint {
      jointParameters HingeJointParameters {
        position -1.15762e-11
        anchor -0.05 0 -0.03
        axis 0 0 1
      }
      endPoint Solid {
        translation -0.05 0 -0.03
        rotation 1 0 0 1.5708
        children [
          USE WHEEL_BOX
          USE WHEEL
        ]
        contactMaterial "nofriction"
        boundingObject USE WHEEL
        physics Physics {
        }
      }
    }
    DEF GPS_SENSOR GPS {
      name "gps"
      translation 0 0 0
    }    
    DEF COMPASS_SENSOR Compass {
      name "compass"
    }
    DEF WHEEL_FRONT_LEFT HingeJoint {
      jointParameters HingeJointParameters {
        anchor 0 0 0.03
        axis 0 0 1
      }
      device RotationalMotor {
        name "wheel_fr"
	maxVelocity 30
      }
      endPoint Gyro {
        name "wheel_gyro_fr"
        translation 0 0 0.03
        rotation 1 0 0 1.5708
        children [
          USE WHEEL_BOX
          USE WHEEL
        ]
        contactMaterial "highfriction"
        boundingObject USE WHEEL
        physics Physics {
        }
      }
    }
    DEF WHEEL_FRONT_RIGHT HingeJoint {
      jointParameters HingeJointParameters {
        position -1.15794e-11
        anchor 0 0 -0.03
        axis 0 0 1
      }
      device RotationalMotor {
        name "wheel_fl"
	maxVelocity 30
      }
      endPoint Gyro {
        name "wheel_gyro_fl"
        translation 0 0 -0.03
        rotation 1 0 0 1.5708
        children [
          USE WHEEL_BOX
          USE WHEEL
        ]
        contactMaterial "highfriction"
        boundingObject USE WHEEL
        physics Physics {
          centerOfMass [
            0 0 0
          ]
        }
      }
    }
    DEF HEAD HingeJoint {
      jointParameters HingeJointParameters {
        anchor   -0.0155 0.025 0
        axis     0 0 1
        maxStop  0.6109 # 35 degrees up
        minStop -0.4363 # 25 degrees down
        position IS headAngle	
      }
      device RotationalMotor {
        name "motor_head_pitch"
      }
      endPoint Solid {
        rotation 0 1 0 0
        children [
          DEF CAM_HEAD Camera {
            translation 0.0095 0.040 0
            rotation 0 1 0 -1.5708
            children [
              Transform {
                translation 0 0 0 # IS spotLightTranslation #0 .03 -.03
                rotation 1 0 0 0 # IS spotLightRotation #1 0 0 0
                children [
                  SpotLight {
                    beamWidth 1 # IS spotLightBeamWidth #0.5
                    cutOffAngle 1.2 # IS spotLightCutOffAngle #0.8
                    direction 0 0 -1 # IS spotLightDirection #0 0 -1
                    intensity 0.8
                  }
                ]
              }
            ]
            name "cam_head"
            spherical IS useSphericalHeadCamera
            width 640
            height 480
            fieldOfView IS fieldOfViewHead
            near 0.001
            pixelSize 0.5
            colorNoise 0.01
          }
          DEF EYE_LEFT Transform {
            translation -0.015 0.045 0.017
            rotation 0 0 1 -1.5708
            children [
              DEF EYE_SHAPE Shape {
                appearance Appearance {
                  material Material {
                    diffuseColor 1 1 1
                  }
                }
                geometry Cylinder {
                  height 0.04
                  radius 0.015
                  subdivision 24
                }
              }
            ]
          }
          DEF EYE_RIGHT Transform {
            translation -0.015 0.045 -0.017
            rotation 0 0 1 -1.5708
            children [
              USE EYE_SHAPE
            ]
          }
        ]
      }
    }
  ]
  name IS name
  
  physics Physics {
    density -1
    mass 1
  }
  locked TRUE
  controller IS controller
} # Supervisor definition
} # PROTO definition