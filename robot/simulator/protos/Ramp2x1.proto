#VRML_SIM V7.3.0 utf8

PROTO Ramp2x1 [
  field SFString name "Ramp000"
  
  # Dimensions
  field SFFloat width .062
  field SFFloat platformLength .044
  field SFFloat rampLength .110
  field SFFloat height .044
  field SFFloat trackWidth .01
  field SFFloat guideWidth .002
  field SFFloat guideHeight .01
  field SFFloat frontMarkerDistance .050
  field SFFloat markerWidth .025
  
  field SFString type "1" # RampType
  field SFVec3f translation 0 0 0.022
  field SFRotation rotation 0 0 1 0
  field SFFloat density 250
  field SFColor color .2 .2 .2
  field SFBool  useWhiteMarkerBackgrounds TRUE

]
{
Solid {

  name IS name
  model IS type
  translation IS translation
  rotation IS rotation
  contactMaterial "cmat_ramp"
  
  children [
        
    # Front Face
    Transform {
      rotation 0 1 0 %{=-math.atan(fields.rampLength/fields.height)}% 
      translation %{=fields.rampLength + (fields.platformLength/2) - fields.frontMarkerDistance + .0001}% 0 %{=-fields.height/2+fields.height*fields.frontMarkerDistance/fields.rampLength}%
      children [
        VisionMarker {
          rotation 0 0 1 1.5708      
          image "symbols/rampFront.png"
          markerWidth IS markerWidth
        }
      ]
    }
    
    # Back Face
    VisionMarker { 
      rotation 0 0 1 -1.5708
      translation %{=-fields.platformLength/2}% 0 0
      image "symbols/rampBack.png"
      markerWidth IS markerWidth
    }
          
    # Right Face
    VisionMarker {
      rotation 0 0 1 3.1415
      translation 0.01 %{=fields.width/2}% 0
      image "symbols/rampRight.png"
      markerWidth IS markerWidth
      connectorName "rightConnector"
      connectorRotation 1 0 0 -1.57079
    }
    
    # Left Face
    VisionMarker {
      rotation 0 0 1 0
      translation 0.01 %{=-fields.width/2}% 0
      image "symbols/rampLeft.png"
      markerWidth IS markerWidth
      connectorName "leftConnector"
      connectorRotation 1 0 0 1.57079
    }
    
    # Top Face
    Transform {
      rotation 0 1 0 1.5708
			translation %{=fields.platformLength/2-fields.markerWidth/2}% 0 %{=fields.height/2}%
			children [
        VisionMarker {
          rotation 0 0 1 -1.5708
          image "symbols/inverted/rampFront.png"
          markerWidth IS markerWidth
        }
      ]
		}
      
    DEF RampShape Group {
      children [
        # Back Box
        Transform {
          translation %{=-fields.platformLength/2+fields.trackWidth/2}% 0 0 
          children [
            Shape {
              appearance Appearance {
                material Material {
                  diffuseColor IS color
                }
              }
              geometry DEF RampBack Box {
                size %{=fields.trackWidth}% %{=fields.width-2*fields.trackWidth}% %{=fields.height}%
              }
            }
          ]
        } # Back Box Transform
      
        # Left Side      
        Transform {
          translation 0 %{=-fields.width/2+fields.trackWidth/2+fields.guideWidth}% 0 
          children [
            DEF RampSide Shape {
              appearance Appearance {
                material Material {
                  diffuseColor IS color
                }
              }
              geometry IndexedFaceSet {
                coord Coordinate {
                  point [
                    %{=-fields.platformLength/2}%                        %{=-fields.trackWidth/2}%  %{=-fields.height/2}%
                    %{= fields.rampLength + fields.platformLength/2}%    %{=-fields.trackWidth/2}%  %{=-fields.height/2}%
                    %{= fields.rampLength + fields.platformLength/2}%    %{= fields.trackWidth/2}%  %{=-fields.height/2}%
                    %{=-fields.platformLength/2}%                        %{= fields.trackWidth/2}%  %{=-fields.height/2}%
                    %{= fields.platformLength/2}%                        %{=-fields.trackWidth/2}%  %{= fields.height/2}%
                    %{= fields.platformLength/2}%                        %{= fields.trackWidth/2}%  %{= fields.height/2}%
                    %{=-fields.platformLength/2}%                        %{=-fields.trackWidth/2}%  %{= fields.height/2}%
                    %{=-fields.platformLength/2}%                        %{= fields.trackWidth/2}%  %{= fields.height/2}%
                  ]
                }
                coordIndex [
                  0, 1, 4, 6, -1, 
                  3, 7, 5, 2, -1, 
                  1, 2, 5, 4, -1, 
                  4, 5, 7, 6, -1,
                  0, 6, 7, 3, -1,
                  3, 2, 1, 0                  
                ]
              }
            } # RampSide Shape

          ] # Solid Children
        } # Left Side Transform
    
        # Right side
        Transform { 
          translation 0 %{=fields.width/2-fields.trackWidth/2-fields.guideWidth}% 0
          children [
            USE RampSide
          ]
        } # Right Side Transform
    
        # Left Guide
        Transform {
          translation 0 %{=-fields.width/2+fields.guideWidth/2}% 0
          children [
            DEF WheelGuide Shape {
              appearance Appearance {
                material Material {
                  diffuseColor IS color
                }
              }
              geometry IndexedFaceSet {
                coord Coordinate {
                  point [
                    %{=-fields.platformLength/2}%                        %{=-fields.guideWidth/2}%  %{=-fields.height/2}%
                    %{= fields.rampLength + fields.platformLength/2}%    %{=-fields.guideWidth/2}%  %{=-fields.height/2}%
                    %{= fields.rampLength + fields.platformLength/2}%    %{= fields.guideWidth/2}%  %{=-fields.height/2}%
                    %{=-fields.platformLength/2}%                        %{= fields.guideWidth/2}%  %{=-fields.height/2}%
                    %{= fields.rampLength + fields.platformLength/2}%    %{=-fields.guideWidth/2}%  %{=-fields.height/2+fields.guideHeight}%
                    %{= fields.rampLength + fields.platformLength/2}%    %{= fields.guideWidth/2}%  %{=-fields.height/2+fields.guideHeight}%
                    %{= fields.platformLength/2}%                        %{=-fields.guideWidth/2}%  %{= fields.height/2+fields.guideHeight}%
                    %{= fields.platformLength/2}%                        %{= fields.guideWidth/2}%  %{= fields.height/2+fields.guideHeight}%
                    %{=-fields.platformLength/2}%                        %{=-fields.guideWidth/2}%  %{= fields.height/2+fields.guideHeight}%
                    %{=-fields.platformLength/2}%                        %{= fields.guideWidth/2}%  %{= fields.height/2+fields.guideHeight}%
                  ]
                }
                coordIndex [
                  0, 1, 4, -1, 
                  0, 4, 6, 8, -1,
                  1, 2, 5, 4, -1,
                  2, 3, 5, -1, 
                  5, 3, 9, 7, -1, 
                  0, 8, 9, 3, -1, 
                  3, 2, 1, 0, -1, 
                  4, 5, 7, 6, -1, 
                  6, 7, 9, 8                  
                ]
              }
            } # WheelGuide Shape
          ] # Transform Children
        } # Left Guide Transform
        
        
        # Right Guide
        Transform {
          translation 0 %{=fields.width/2-fields.guideWidth/2}% 0
          children [
            USE WheelGuide
          ] # Transform Children
        } # Right Guide Transform
        
      ] # RampShape Group Children
    } # RampShape Group
    
    # Non-Solid Interior (for appearance but does not collide with robot bottom)
    Shape {
      appearance Appearance {
        material Material {
          diffuseColor IS color
        }
      }
      geometry IndexedFaceSet {
        coord Coordinate {
          point [
            %{=-fields.platformLength/2+fields.trackWidth}%     %{=-fields.width/2+fields.trackWidth}%  %{=-fields.height/2}%
            %{= fields.rampLength + fields.platformLength/2}%   %{=-fields.width/2+fields.trackWidth}%  %{=-fields.height/2}%
            %{= fields.rampLength + fields.platformLength/2}%   %{= fields.width/2-fields.trackWidth}%  %{=-fields.height/2}%
            %{=-fields.platformLength/2+fields.trackWidth}%     %{= fields.width/2-fields.trackWidth}%  %{=-fields.height/2}%
            %{= fields.platformLength/2}%                       %{=-fields.width/2+fields.trackWidth}%  %{= fields.height/2}%
            %{= fields.platformLength/2}%                       %{= fields.width/2-fields.trackWidth}%  %{= fields.height/2}%
            %{=-fields.platformLength/2+fields.trackWidth}%     %{=-fields.width/2+fields.trackWidth}%  %{= fields.height/2}%
            %{=-fields.platformLength/2+fields.trackWidth}%     %{= fields.width/2-fields.trackWidth}%  %{= fields.height/2}%
          ]
        }
        coordIndex [
          1, 2, 5, 4, -1, 
          3, 2, 1, 0, -1, 
          4, 5, 7, 6
        ]
      }
    } # Non-solid interior shape
   
  ] # Solid Children
  
  boundingObject USE RampShape
  
  physics Physics {
    density IS density
  }
  
} # Parent Solid (the actual ramp)

  
} # PROTO