:: Name:         versionGenerator.bat
:: Purpose:      Creates version.h for Keil build
:: Author:       kevin@anki.com
:: Date Created: Dec 16, 2015

@ECHO OFF

:: Get file path
IF [%1]==[] (
  ECHO No output .h file specified
  EXIT /B
)
SET file=%1

:: Delete file if it exists already
IF EXIST "%file%" DEL /Q %file% >NUL

:: Get current date and time
:: SET dateTime=%date%_%time%
SET buildDate=%date%

:: Get git commit SHA-1
SET gitCommit=0
WHERE git >NUL
IF %ERRORLEVEL% NEQ 0 (
  ECHO git not found. Generating default version.h.
) ELSE (
  FOR /f "delims=" %%i in ('git rev-parse --short HEAD') DO SET gitCommit=%%i
)


:: Print out header
ECHO /***************************************************          >> "%file%"
ECHO  * File: version.h                                            >> "%file%"
ECHO  * Description: Version and date info for KEIL build          >> "%file%"
ECHO  *                                                            >> "%file%"
ECHO  *     DO NOT MODIFY!!!                                       >> "%file%"   
ECHO  *     This file is autogenerated during Keil build.          >> "%file%"
ECHO  ***************************************************/         >> "%file%"
ECHO.  >> "%file%"
ECHO static const char* BUILD_DATE = "%buildDate%";                   >> "%file%"
ECHO static const unsigned int COZMO_VERSION_COMMIT = 0x%gitCommit%;  >> "%file%"
ECHO.  >> "%file%"