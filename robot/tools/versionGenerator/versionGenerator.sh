#!/bin/bash

# Copied this from anki-util's VersionGenerator.
# Maybe we can make anki-util's VersionGenerator more generic, 
# but for now cozmo-engine repo gets its own.
# - Kevin Yoon (Nov 2015)

VersionFile=$1

# build version file name
if [ -z $VersionFile ]; then
  echo Need to specify version file name to generate.
  exit 1
fi

# Remove file if it exists
rm -f $VersionFile

# find git
GIT=`which git`
if [ -z $GIT ]
then
  echo git not found
  exit 1
fi


# Get git SHA-1
Commit=`$GIT rev-parse --short HEAD`
DasUser=`whoami`
Date=`date +%Y-%m-%d..%H:%M`

# Get just the name of the file
fileName=$(basename $VersionFile)

echo "/********************************************************"   >> $VersionFile
echo "* File: $fileName                                       *"   >> $VersionFile
echo "* Description: Version and date info for firmware build *"   >> $VersionFile
echo "*                                                       *"   >> $VersionFile
echo "*     DO NOT MODIFY!!!                                  *"   >> $VersionFile
echo "*     This file is autogenerated during firmware build. *"   >> $VersionFile
echo "*********************************************************/"  >> $VersionFile
echo " "                                                           >> $VersionFile
echo "// Build version info" >> $VersionFile
echo "#ifdef SIMULATOR" >> $VersionFile
echo "static const char* BUILD_DATE = \"0\";" >> $VersionFile
echo "static const unsigned int COZMO_VERSION_COMMIT = 0;" >> $VersionFile
echo "#else" >> $VersionFile
echo "// This file is autogenerated during Keil build" >> $VersionFile
echo "static const unsigned int COZMO_VERSION_COMMIT = 0x$Commit;" >> $VersionFile
echo "static const char* DAS_USER = \"$DasUser\";"                 >> $VersionFile
echo "static const char* BUILD_DATE = \"$Date\";"                    >> $VersionFile

echo "Cozmo FW version file generated"
exit 0
